
@{
    ViewBag.Title = "Upload";
}

<style>
    .progress {
  background: red !important;
  display: block !important;
  height: 20px !important;
  text-align: center !important;
  transition: width .3s !important;
  width: 0 !important;
}

.progress.hide {
  opacity: 0 !important;
  transition: opacity 1.3s !important;
}
</style>

<h2>Upload File</h2>
<div class="container">
    <form method="post" action="#" id="upload">
        <div class="row">
            <div class="btn btn-primary col-md-4">
                <input type="file" id="imageBrowes" />
            </div>
            <hr />
            <div id="imgPreview" class="col-md-4 thumbnail" style="display:none">
                <img class="img-responsive" id="targetImg" />
                <div class="caption">
                    <a href="#" onclick="ClearPreview()"><i class="glyphicon glyphicon-trash"></i></a>
                    <span id="description"></span>
                </div>
                <a href="#" class="btn btn-default" onclick="Uploadimage()">Upload</a>
            </div>
            <div class="btn btn-primary col-md-4">
                <input type="text" id="fileName" />
            </div>
        </div>
        <div class="row">
            <progress id="prog" max="100" value="0" style="display : none;"></progress>
        </div>
    </form>
</div>


<script src="~/Scripts/jquery-1.10.2.js"></script>
<script>
    $(document).ready(function () {

        var name = $('#fileName').val();

        $("#imageBrowes").change(function () {

            var File = this.files;

            if (File && File[0]) {
                ReadImage(File[0]);
            }

        });
    });

    var progress = $('.progress');
    var progressLabel = $('#progressbar-label');
    var progressbar = $('.progress-bar');

    var ReadImage = function (file) {

        var reader = new FileReader;
        var image = new Image;

        reader.readAsDataURL(file);
        reader.onload = function (_file) {

            image.src = _file.target.result;
            image.onload = function () {

                var height = this.height;
                var width = this.width;
                var type = file.type;
                var size = ~~(file.size / 1024) + "KB";

                $("#targetImg").attr('src', _file.target.result);
                $("#description").text("Size:" + size + ", " + height + "X " + width + ", " + type + "");
                $("#imgPreview").show();

            }

        }

    }

    var ClearPreview = function () {
        $("#imageBrowes").val('');
        $("#description").text('');
        $("#imgPreview").hide();

    }

    var Uploadimage = function () {

        var file = $("#imagebrowes").get(0).files;
         
        var data = new formdata;
        data.append("imagefile", file[0]);
        data.append("productname", name);

        $.ajax({
            type: "post",
            url: "/imageupload/upload",
            data: data,
            contenttype: false,
            processdata: false,
            //xhr: function () {
            //    debugger;
            //    var xhr = new window.xmlhttprequest();
            //    xhr.upload.addeventlistener("progress", function (event, posotion, total, percentComplete) {
            //        //if (evt.lengthcomputable) {
            //            //var percentcomplete = evt.loaded / evt.total;
            //            //console.log(percentcomplete);
            //            //$('.progress').css({
            //            //    width: percentcomplete * 100 + '%'
            //            //});
            //            //if (percentcomplete === 1) {
            //            //    $('.progress').addclass('hide');
            //            //}

            //        // }
            //        $('#prog').show();
            //        $('#prog').attr('value', '0');
            //        $('#prog').attr('value', percentComplete);

            //    }, false);
            //    xhr.addeventlistener("progress", function (evt) {
            //        if (evt.lengthcomputable) {
            //            var percentcomplete = evt.loaded / evt.total;
            //            console.log(percentcomplete);
            //            $('.progress').css({
            //                width: percentcomplete * 100 + '%'
            //            });
            //        }
            //    }, false);
            //    return xhr;
            //},

            //xhr: function () {
            //    var xhr = new window.xmlhttprequest();


            //    xhr.upload.onprogress(function (event, position, total, persentcomplete) {
            //        $('.progress-bar').width(persentcomplete + '%');
            //        $('.progress-bar').html('<div id="progress-status">' + persentcomplete + '%</div>');
            //    });

              
            //},
            //uploadprogress: function (event, position, total, persentcomplete) {
            //    $('.progress-bar').width(persentcomplete + '%');
            //    $('.progress-bar').html('<div id="progress-status">' + persentcomplete + '%</div>');
            //},
            success: function (response) {
                clearpreview();
                $("#uploadedimage").append('<img src="/uploadedimage/' + response + '" class="img-responsive thumbnail"/>');
                alert("File uploaded");
            }
        });

     }
   
    //$('upload').on('submit', function (e) {
    //    e.preventDefault;
    //    var file = $("#imagebrowes").get(0).files;

    //    var data = new formdata;
    //    data.append("imagefile", file[0]);
    //    data.append("productname", name);

    //    $(this).ajaxSubmit({
    //        type: "post",
    //        url: "/imageupload/upload",
    //        data: data,
    //        beforeSend: function () {
    //            $('#prog').show();
    //            $('#prog').attr('value', '0');
    //        },
    //        uploadProgress: function (event, posotion, total, percentComplete) {
    //            $('#prog').attr('value', percentComplete);
    //        },
    //        contenttype: false,
    //        processdata: false,
    //        success: function (response) {
    //            clearpreview();
    //            $("#uploadedimage").append('<img src="/uploadedimage/' + response + '" class="img-responsive thumbnail"/>');
    //        }
    //    });

    //})
</script>